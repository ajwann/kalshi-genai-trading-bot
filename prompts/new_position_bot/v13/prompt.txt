Create a GenAI powered trading bot named “New Position Bot”, that will trade on Kalshi. Your instructions are separated into two sections below; “General bot design and architecture”, and “GenAI prompt creation”. The Kalshi demo environment base URL is “https://demo-api.kalshi.co/trade-api/v2”. Kalshi uses RSA private keys in PEM format.

Use your “browse_page” tool to read all of the documentation at the following pages:
https://peps.python.org/pep-0008
https://docs.python.org/3.13
https://docs.x.ai/docs/api-reference
https://docs.kalshi.com
https://docs.kalshi.com/api-reference/communications/accept-quote
https://docs.kalshi.com/api-reference/communications/confirm-quote
https://docs.kalshi.com/api-reference/communications/create-quote
https://docs.kalshi.com/api-reference/communications/create-rfq
https://docs.kalshi.com/api-reference/communications/delete-quote
https://docs.kalshi.com/api-reference/communications/delete-rfq
https://docs.kalshi.com/api-reference/communications/get-communications-id
https://docs.kalshi.com/api-reference/communications/get-quote
https://docs.kalshi.com/api-reference/communications/get-quotes
https://docs.kalshi.com/api-reference/communications/get-rfq
https://docs.kalshi.com/api-reference/communications/get-rfqs
https://docs.kalshi.com/api-reference/events/get-event
https://docs.kalshi.com/api-reference/events/get-event-candlesticks
https://docs.kalshi.com/api-reference/events/get-event-forecast-percentile-history
https://docs.kalshi.com/api-reference/events/get-event-metadata
https://docs.kalshi.com/api-reference/events/get-events
https://docs.kalshi.com/api-reference/events/get-multivariate-events
https://docs.kalshi.com/api-reference/exchange/get-exchange-announcements
https://docs.kalshi.com/api-reference/exchange/get-exchange-schedule
https://docs.kalshi.com/api-reference/exchange/get-exchange-status
https://docs.kalshi.com/api-reference/exchange/get-series-fee-changes
https://docs.kalshi.com/api-reference/exchange/get-user-data-timestamp
https://docs.kalshi.com/api-reference/incentive-programs/get-volume-incentives
https://docs.kalshi.com/api-reference/market/batch-get-market-candlesticks
https://docs.kalshi.com/api-reference/market/get-market
https://docs.kalshi.com/api-reference/market/get-market-candlesticks
https://docs.kalshi.com/api-reference/market/get-markets
https://docs.kalshi.com/api-reference/market/get-market-orderbook
https://docs.kalshi.com/api-reference/market/get-series
https://docs.kalshi.com/api-reference/market/get-series-list
https://docs.kalshi.com/api-reference/market/get-trades
https://docs.kalshi.com/api-reference/multivariate/create-market-in-multivariate-event-collection
https://docs.kalshi.com/api-reference/multivariate/get-multivariate-event-collection
https://docs.kalshi.com/api-reference/multivariate/get-multivariate-event-collection-lookup-history
https://docs.kalshi.com/api-reference/multivariate/get-multivariate-event-collections
https://docs.kalshi.com/api-reference/multivariate/lookup-tickers-for-market-in-multivariate-event-collection
https://docs.kalshi.com/api-reference/order-groups/create-order-group
https://docs.kalshi.com/api-reference/order-groups/delete-order-group
https://docs.kalshi.com/api-reference/order-groups/get-order-group
https://docs.kalshi.com/api-reference/order-groups/get-order-groups
https://docs.kalshi.com/api-reference/order-groups/reset-order-group
https://docs.kalshi.com/api-reference/orders/amend-order
https://docs.kalshi.com/api-reference/orders/batch-cancel-orders
https://docs.kalshi.com/api-reference/orders/batch-create-orders
https://docs.kalshi.com/api-reference/orders/cancel-order
https://docs.kalshi.com/api-reference/orders/create-order
https://docs.kalshi.com/api-reference/orders/decrease-order
https://docs.kalshi.com/api-reference/orders/get-order
https://docs.kalshi.com/api-reference/orders/get-order-queue-position
https://docs.kalshi.com/api-reference/orders/get-orders
https://docs.kalshi.com/api-reference/orders/get-queue-positions-for-orders
https://docs.python.org/3.13/tutorial/index.html
https://docs.python.org/3.13/tutorial/introduction.html
https://docs.python.org/3.13/tutorial/appendix.html
https://docs.python.org/3.13/tutorial/appetite.html
https://docs.python.org/3.13/tutorial/interactive.html
https://docs.python.org/3.13/tutorial/interpreter.html
https://docs.python.org/3.13/tutorial/intro.html
https://docs.python.org/3.13/tutorial/venv.html
https://docs.python.org/3.13/tutorial/controlflow.html
https://docs.python.org/3.13/tutorial/datastructures.html
https://docs.python.org/3.13/tutorial/errors.html
https://docs.python.org/3.13/tutorial/floatingpoint.html
https://docs.python.org/3.13/tutorial/formatted_string_literals.html
https://docs.python.org/3.13/tutorial/functions.html
https://docs.python.org/3.13/tutorial/inputoutput.html
https://docs.python.org/3.13/tutorial/modules.html
https://docs.python.org/3.13/tutorial/stdlib.html
https://docs.python.org/3.13/tutorial/stdlib2.html
https://docs.python.org/3.13/tutorial/brieftour.html
https://docs.python.org/3.13/tutorial/classes.html
https://docs.python.org/3.13/tutorial/conditional.html
https://docs.python.org/3.13/tutorial/customization.html
https://docs.python.org/3.13/tutorial/formats.html
https://docs.python.org/3.13/tutorial/history.html
https://docs.python.org/3.13/tutorial/history2.html
https://docs.python.org/3.13/tutorial/indexobjects.html
https://docs.python.org/3.13/tutorial/installation.html
https://docs.python.org/3.13/tutorial/interoperating.html
https://docs.python.org/3.13/tutorial/iterator_protocol.html
https://docs.python.org/3.13/tutorial/lists.html
https://docs.python.org/3.13/tutorial/morecontrol.html
https://docs.python.org/3.13/tutorial/nondet.html
https://docs.python.org/3.13/tutorial/pep514.html
https://docs.python.org/3.13/tutorial/random.html
https://docs.python.org/3.13/tutorial/range.html
https://docs.python.org/3.13/tutorial/readingcode.html
https://docs.python.org/3.13/tutorial/scoping.html
https://docs.python.org/3.13/tutorial/stdlib3.html
https://docs.python.org/3.13/tutorial/unicode.html
https://docs.python.org/3.13/tutorial/whatnow.html
https://docs.python.org/3.13/tutorial/whatsnew/index.html
https://docs.python.org/3.13/tutorial/whatsnew/2.0.html
https://docs.python.org/3.13/tutorial/whatsnew/2.1.html
https://docs.python.org/3.13/tutorial/whatsnew/2.2.html
https://docs.python.org/3.13/tutorial/whatsnew/2.3.html
https://docs.python.org/3.13/tutorial/whatsnew/2.4.html
https://docs.python.org/3.13/tutorial/whatsnew/2.5.html
https://docs.python.org/3.13/tutorial/whatsnew/2.6.html
https://docs.python.org/3.13/tutorial/whatsnew/3.0.html
https://docs.python.org/3.13/tutorial/whatsnew/3.1.html
https://docs.python.org/3.13/using/index.html
https://docs.python.org/3.13/using/cmdline.html
https://docs.python.org/3.13/using/configure.html
https://docs.python.org/3.13/using/mac.html
https://docs.python.org/3.13/using/unix.html
https://docs.python.org/3.13/using/windows.html
https://docs.python.org/3.13/using/editors.html
https://docs.python.org/3.13/library/index.html
https://docs.python.org/3.13/library/intro.html
https://docs.python.org/3.13/library/functions.html
https://docs.python.org/3.13/library/stdtypes.html
https://docs.python.org/3.13/library/exceptions.html
https://docs.python.org/3.13/library/constants.html
https://docs.python.org/3.13/library/mm.html
https://docs.python.org/3.13/library/stdtypes.html 
https://docs.python.org/3.13/library/string.html
https://docs.python.org/3.13/library/re.html
https://docs.python.org/3.13/library/struct.html
https://docs.python.org/3.13/library/codecs.html
https://docs.python.org/3.13/library/formatter.html
https://docs.python.org/3.13/library/datetime.html
https://docs.python.org/3.13/library/calendar.html
https://docs.python.org/3.13/library/math.html
https://docs.python.org/3.13/library/cmath.html
https://docs.python.org/3.13/library/random.html
https://docs.python.org/3.13/library/statistics.html
https://docs.python.org/3.13/library/numbers.html
https://docs.python.org/3.13/library/fractions.html
https://docs.python.org/3.13/library/decimal.html
https://docs.python.org/3.13/library/itertools.html
https://docs.python.org/3.13/library/functools.html
https://docs.python.org/3.13/library/operator.html
https://docs.python.org/3.13/library/collections.html
https://docs.python.org/3.13/library/array.html
https://docs.python.org/3.13/library/weakref.html
https://docs.python.org/3.13/library/copy.html
https://docs.python.org/3.13/library/pprint.html
https://docs.python.org/3.13/library/reprlib.html
https://docs.python.org/3.13/library/enum.html
https://docs.python.org/3.13/library/bisect.html
https://docs.python.org/3.13/library/heapq.html
https://docs.python.org/3.13/library/queue.html
https://docs.python.org/3.13/library/deque.html 
https://docs.python.org/3.13/library/os.html
https://docs.python.org/3.13/library/io.html
https://docs.python.org/3.13/library/time.html
https://docs.python.org/3.13/library/argparse.html
https://docs.python.org/3.13/library/getopt.html
https://docs.python.org/3.13/library/logging.html
https://docs.python.org/3.13/library/gettext.html
https://docs.python.org/3.13/library/locale.html
https://docs.python.org/3.13/library/index.html#library-index
https://docs.python.org/3.13/library/py-modindex.html 
https://docs.python.org/3.13/reference/index.html
https://docs.python.org/3.13/reference/introduction.html
https://docs.python.org/3.13/reference/lexical_analysis.html
https://docs.python.org/3.13/reference/datamodel.html
https://docs.python.org/3.13/reference/executionmodel.html
https://docs.python.org/3.13/reference/expressions.html
https://docs.python.org/3.13/reference/simple_stmts.html
https://docs.python.org/3.13/reference/compound_stmts.html
https://docs.python.org/3.13/reference/toplevel_components.html
https://docs.python.org/3.13/reference/grammar.html
https://docs.python.org/3.13/extending/index.html
https://docs.python.org/3.13/extending/extending.html
https://docs.python.org/3.13/extending/building.html
https://docs.python.org/3.13/extending/embedding.html
https://docs.python.org/3.13/c-api/index.html
https://docs.python.org/3.13/c-api/init.html
https://docs.python.org/3.13/c-api/veryhigh.html
https://docs.python.org/3.13/c-api/stable.html
https://docs.python.org/3.13/c-api/concrete.html
https://docs.python.org/3.13/c-api/abstract.html
https://docs.python.org/3.13/c-api/type.html
https://docs.python.org/3.13/c-api/memory.html
https://docs.python.org/3.13/c-api/objbuffer.html
https://docs.python.org/3.13/c-api/structures.html
https://docs.python.org/3.13/c-api/utilities.html
https://docs.python.org/3.13/c-api/arg.html
https://docs.python.org/3.13/c-api/advanced.html
https://docs.python.org/3.13/c-api/indexing.html
https://docs.python.org/3.13/c-api/slice.html
https://docs.python.org/3.13/c-api/iterator.html
https://docs.python.org/3.13/c-api/descriptor.html
https://docs.python.org/3.13/c-api/weakref.html
https://docs.python.org/3.13/c-api/context.html
https://docs.python.org/3.13/distributing/index.html
https://docs.python.org/3.13/distributing/setuptools.html
https://docs.python.org/3.13/distributing/index.html#distributing-python-modules
https://docs.python.org/3.13/installing/index.html
https://docs.python.org/3.13/install/index.html
https://docs.python.org/3.13/install/alternatives.html
https://docs.python.org/3.13/howto/index.html
https://docs.python.org/3.13/howto/argparse.html
https://docs.python.org/3.13/howto/descriptor.html
https://docs.python.org/3.13/howto/functional.html
https://docs.python.org/3.13/howto/instrumentation.html
https://docs.python.org/3.13/howto/ipaddress.html
https://docs.python.org/3.13/howto/logging.html
https://docs.python.org/3.13/howto/logging-cookbook.html
https://docs.python.org/3.13/howto/pyporting.html
https://docs.python.org/3.13/howto/regex.html
https://docs.python.org/3.13/howto/sockets.html
https://docs.python.org/3.13/howto/sorting.html
https://docs.python.org/3.13/howto/unicode.html
https://docs.python.org/3.13/howto/wmo.html
https://docs.python.org/3.13/howto/cporting.html
https://docs.python.org/3.13/faq/index.html
https://docs.python.org/3.13/faq/programming.html
https://docs.python.org/3.13/faq/design.html
https://docs.python.org/3.13/faq/general.html
https://docs.python.org/3.13/faq/account.html
https://docs.python.org/3.13/faq/pythonlist.html
https://docs.python.org/3.13/glossary.html
https://docs.python.org/3.13/genindex.html
https://docs.python.org/3.13/py-modindex.html
https://docs.python.org/3.13/search.html
https://docs.python.org/3.13/whatsnew/index.html
https://docs.python.org/3.13/whatsnew/3.13.html
https://docs.python.org/3.13/whatsnew/changelog.html
https://docs.python.org/3.13/bugs.html
https://docs.python.org/3.13/license.html
https://docs.python.org/3.13/copyright.html
https://peps.python.org/pep-0008/
https://peps.python.org/pep-0008/#introduction
https://peps.python.org/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds
https://peps.python.org/pep-0008/#code-lay-out
https://peps.python.org/pep-0008/#indentation
https://peps.python.org/pep-0008/#tabs-or-spaces
https://peps.python.org/pep-0008/#maximum-line-length
https://peps.python.org/pep-0008/#should-a-line-break-before-or-after-a-binary-operator
https://peps.python.org/pep-0008/#blank-lines
https://peps.python.org/pep-0008/#source-file-encoding
https://peps.python.org/pep-0008/#imports
https://peps.python.org/pep-0008/#module-level-dunder-names
https://peps.python.org/pep-0008/#string-quotes
https://peps.python.org/pep-0008/#whitespace-in-expressions-and-statements
https://peps.python.org/pep-0008/#when-to-use-trailing-commas
https://peps.python.org/pep-0008/#comments
https://peps.python.org/pep-0008/#block-comments
https://peps.python.org/pep-0008/#inline-comments
https://peps.python.org/pep-0008/#documentation-strings
https://peps.python.org/pep-0008/#naming-conventions
https://peps.python.org/pep-0008/#descriptive-naming-styles
https://peps.python.org/pep-0008/#prescriptive-naming-conventions
https://peps.python.org/pep-0008/#names-to-avoid
https://peps.python.org/pep-0008/#ascii-compatibility
https://peps.python.org/pep-0008/#package-and-module-names
https://peps.python.org/pep-0008/#class-names
https://peps.python.org/pep-0008/#type-variable-names
https://peps.python.org/pep-0008/#exception-names
https://peps.python.org/pep-0008/#global-variable-names
https://peps.python.org/pep-0008/#function-and-variable-names
https://peps.python.org/pep-0008/#function-and-method-arguments
https://peps.python.org/pep-0008/#method-names-and-instance-variables
https://peps.python.org/pep-0008/#constants
https://peps.python.org/pep-0008/#designing-for-inheritance
https://peps.python.org/pep-0008/#public-and-internal-interfaces
https://peps.python.org/pep-0008/#programming-recommendations
https://peps.python.org/pep-0008/#function-annotations
https://peps.python.org/pep-0008/#variable-annotations
https://peps.python.org/pep-0008/#references
https://peps.python.org/pep-0008/#copyright
https://peps.python.org/pep-0008/#revision-history



General bot design and architecture:

Make the bot stateless, so it can be run on Google Cloud Platform as a Cloud Function. The bot should also be able to run locally, while logging to standard out. Use Python 3.13.11. Use environment variables for the Kalshi API key and private key. Use enforcement variables for the Grok integration so that users can switch between Grok models. The bot should call the Kalshi demo environment API, but that base API URL should be configurable via an environment variable in case users want to call the production Kalshi environment.

The “New Position Bot” bot should run every hour, and should analyze active/open markets newly created in the past hour in which it doesn’t currently have a position. This hour “look back period” should be configurable via an environment variable, but default to an hour. When it finds a market in which it doesn’t currently have a position, it should make an API call to Grok, and ask the Grok 4.1 model which positions in that market to take, if any. 

Create unit tests, integration tests, and functional/end-to-end tests using Pytest. Ensure the bot has detailed logging. The environment variables should be named as follows; KALSHI_API_KEY, KALSHI_BASE_URL, LOOKBACK_HOURS, GROK_MODEL, XAI_API_KEY. The main entry point into the bot should be main.py. Make main.py runnable locally and also work as a Cloud Function. The Kalshi RSA private key should be loaded from a file in the root of the project named “kalshi_private_key” when running on my local. When running as a Cloud Function on GCP the Kalshi private key should be read from GCP’s Secret Manager. 

GenAI prompt creation: 

Generate a “role-based” prompt that the trading bot can send to Grok 4.1. The prompt should tell Grok it’s an expert in professional prediction market trading like Domer, and needs to perform online research to become an expert in a market before taking a position. This prompt should instruct Grok to respond with a JSON object containing two key/value pairs. One key should be “ticker”, with a value of the unique identifier of the market it records we enter. The other key should be “explanation”, with a value that’s a textual explanation of why this particular market was chosen. Here is an example {“ticker”: “123”, explanation”: “I think X will happen based on…”}. The “New Position Bot” should parse this JSON response. If Grok does not recommend that any position be taken, the values returned for the “market_id” and “description” key should be null. Here is an example {“ticker”: null, “description”: null}. The JSON returned by Grok must be RFC 8259 compliant.

The “New Position Bot” bot should purchase any positions recommended by Grok’s response.

